---
title: "Project"
output: html_document
date: "2023-12-12"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```






















# Data Pre-processing

```{r,results='markup'}
data= read.csv('DataCoSupplyChainDataset.csv')
head(data)
```


```{r,results='markup'}
str(data)
```


```{r,results='markup'}
dim(is.na(data))
```


```{r,results='markup'}
data$`Customer.Full.Name` <- paste(data$`Customer.Fname`, data$`Customer.Lname`)
```
```{r,results='markup'}
colSums(is.na(data))
```

```{r,results='markup'}
data[1, ]

```

```{r,results='markup'}
data$Customer.Email <- NULL
data$Customer.Password <- NULL
data$Order.Zipcode <-NULL
data$Product.Description <- NULL
data$Product.Image<-NULL
data$order.date..DateOrders. <- NULL
data$shipping.date..DateOrders.<- NULL
data$Customer.Fname <- NULL
data$Customer.Lname <- NULL
data$Product.Status <-NULL
data$Customer.Street <- NULL
data$Latitude<- NULL
data$Longitude <- NULL
```

```{r,results='markup'}
data[1,]
```

```{r,results='markup'}
colSums(is.na(data))
```

```{r,results='markup'}
data <- na.omit(data)
```

```{r,results='markup'}
dim(data)
```

```{r,results='markup'}
str(data)
```

```{r,results='markup'}
unique_values_count <- sapply(data, function(x) length(unique(x)))
unique_values_count
```


```{r,results='markup'}
colnames(data)
```

```{r,results='markup'}
data$Type <- as.factor(data$Type)
data$Delivery.Status <- as.factor(data$Delivery.Status)
data$Late_delivery_risk <- as.factor(data$Late_delivery_risk)
data$Category.Id <- as.factor(data$Category.Id)
data$Category.Name <- as.factor(data$Category.Name)
data$Customer.City <- as.factor(data$Customer.City)
data$Customer.Country <- as.factor(data$Customer.Country)
data$Customer.Segment <- as.factor(data$Customer.Segment)
data$Customer.State <- as.factor(data$Customer.State)
data$Department.Id <- as.factor(data$Department.Id)
data$Department.Name <- as.factor(data$Department.Name)
data$Market <- as.factor(data$Market)
data$Order.City <- as.factor(data$Order.City)
data$Order.Country <- as.factor(data$Order.Country)
data$Order.Region <- as.factor(data$Order.Region)
data$Order.State <- as.factor(data$Order.State)
data$Order.Status <- as.factor(data$Order.Status)
data$Product.Card.Id <- as.factor(data$Product.Card.Id)
data$Product.Category.Id <- as.factor(data$Product.Category.Id)
data$Product.Name <- as.factor(data$Product.Name)
data$Shipping.Mode <- as.factor(data$Shipping.Mode)
```



```{r,results='markup'}
sapply(data, class)
```

```{r,results='markup'}
value_counts <- table(data$Late_delivery_risk)
value_counts
```



```{r,results='markup'}
data[1,]
```


```{r, results='markup'}
library(corrplot)

numeric_data <- data[, sapply(data, is.numeric)]
cor_matrix <- cor(numeric_data)
corrplot(cor_matrix, method = "color", type = "upper", order = "hclust", tl.col = "black", tl.srt = 45)
```

With this Correlation plot, we can observe that there are columns that are redundant like `Order.Item.Product.Price` and `Product.Price`. So let's remove the redundant colmns and plot the correlation again.

```{r, results='markup'}
# deleting redundant columns
data$Order.Item.Product.Price <- NULL
data$Sales.per.customer <- NULL
data$Order.Item.Total <- NULL
data$Order.Customer.Id <- NULL
data$Order.Item.Id <- NULL
data$Order.Profit.Per.Order <- NULL
```



# EDA


```{r, results='markup'}
# Correlation plot
numeric_data <- data[, sapply(data, is.numeric)]
cor_matrix <- cor(numeric_data)
corrplot(cor_matrix, method = "color", type = "upper", order = "hclust", tl.col = "black", tl.srt = 45)
```

```{r,results='markup'}
library(ggplot2)
library(dplyr)

custom_colors <- c("#004c6d", "#005b8f", "#0072b2", "#0088d2", "#009fdd")


par(mar = c(5, 5, 4, 2))


category_counts <- table(data$Type)
percentage <- round((category_counts / sum(category_counts)) * 100, 2)

# Create labels with percentages
labels_with_percentage <- paste(names(category_counts), "\n", format(percentage, nsmall = 2), "%", sep = "")


pie(category_counts,
    labels = labels_with_percentage,

    col = custom_colors,
    cex = 0.8,
    init.angle = 90, 
    border = "white" 
)


legend("topright",
       legend = names(category_counts),
       fill = custom_colors,
       cex = 0.8, 
       bty = "n"
)

title(main = "Distribution of Payment Methods", cex.main = 2)

```

```{r, results='markup'}
# Grouping by Market
market <- data %>% group_by(Market)

# Grouping by Order Region
region <- data %>% group_by(`Order.Region`)

# Plotting Total Sales for all Markets
plot_market <- market %>% summarise(total_sales = sum(`Sales`)) %>%
  arrange(desc(total_sales)) %>%
  ggplot(aes(x = reorder(Market, -total_sales), y = total_sales)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Total Sales for all Markets", x = "Market", y = "Total Sales") +
  theme_minimal()

# Plotting Total Sales for all Regions
plot_region <- region %>% summarise(total_sales = sum(`Sales`)) %>%
  arrange(desc(total_sales)) %>%
  ggplot(aes(x = reorder(`Order.Region`, -total_sales), y = total_sales)) +
  geom_bar(stat = "identity", fill = "lightgreen") +
  labs(title = "Total Sales for all Regions", x = "Order Region", y = "Total Sales") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Display the plots
print(plot_market)
print(plot_region)
```

```{r, results='markup'}
total_sales_per_category <- data %>%
  group_by(Category.Name) %>%
  summarize(Total.Sales = sum(Sales)) %>%
  arrange(desc(Total.Sales))


top_10_categories <- head(total_sales_per_category, 10)


ggplot(top_10_categories, aes(x = reorder(Category.Name, Total.Sales), y = Total.Sales / 1e6)) + 
  geom_bar(stat = "identity", fill = "steelblue") +
  coord_flip() + 
  labs(title = "Top Performers: Highest-Selling Product Categories",
       x = "Categories",
       y = "Total Sales (in Millions)") +
  theme_minimal() +
  theme(axis.text.y = element_text(angle = 0, hjust = 1)) + 
  scale_y_continuous(breaks = c(0, 2, 4, 6), labels = c("0", "2", "4", "6")) 
```

```{r, results='markup'}
# Grouping by Category Name
category <- data %>% group_by(`Category.Name`)

# Plotting Total Sales for all Categories
plot_total_sales <- category %>%
  summarise(total_sales = sum(`Sales`)) %>%
  arrange(desc(total_sales)) %>%
  ggplot(aes(x = reorder(`Category.Name`, -total_sales), y = total_sales)) +
  geom_bar(stat = "identity", fill = "skyblue") +
  labs(title = "Total Sales for all Categories", x = "Category Name", y = "Total Sales") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Plotting Average Sales for all Categories
plot_average_sales <- category %>%
  summarise(average_sales = mean(`Sales`)) %>%
  arrange(desc(average_sales)) %>%
  ggplot(aes(x = reorder(`Category.Name`, -average_sales), y = average_sales)) +
  geom_bar(stat = "identity", fill = "lightgreen") +
  labs(title = "Average Sales for all Categories", x = "Category Name", y = "Average Sales") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Plotting Average Price for all Categories
plot_average_price <- category %>%
  summarise(average_price = mean(`Product.Price`)) %>%
  arrange(desc(average_price)) %>%
  ggplot(aes(x = reorder(`Category.Name`, -average_price), y = average_price)) +
  geom_bar(stat = "identity", fill = "coral") +
  labs(title = "Average Price for all Categories", x = "Category Name", y = "Average Price") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))

# Display the plots
print(plot_total_sales)
print(plot_average_sales)
print(plot_average_price)

```


#Model Building

```{r,results='markup'}
train_data <- data
```












